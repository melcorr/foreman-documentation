[[Running_Jobs_on_Hosts]]

[[sect-Managing_Hosts-Choosing_a_Satellite_Capsule_for_Remote_Execution]]
=== How {Project} Selects {SmartProxy} for Remote Execution

===
===
==

[[sect-Managing_Hosts-Establishing_a_Secure_Connection_for_Remote_Commands]]
==


[[sect-Managing_Hosts-Distributing_SSH_Keys_for_Remote_Execution_Manually]]
===
[[sect-Managing_Hosts-Using_API_to_Obtain_SSH_Keys_for_Remote_Execution]]
===

[[sect-Managing_Hosts-Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_during_Provisioning]]
===

==



[[sect-Managing_Hosts-Executing_Remote_Jobs]]
===
[[exam-Managing_Hosts-Executing_a_restorecon_Template_on_Multiple_Hosts]]



====
[[sect-Managing_Hosts-Monitoring_Remote_Jobs]]
==== Monitoring Jobs

You can monitor the progress of the job while it is running. This can help in any troubleshooting that may be required.

Ansible jobs run on batches of 100 hosts, so you cannot cancel a job running on a specific host. A job completes only after the Ansible playbook runs on all hosts in the batch.

[[proc-Managing_Hosts-Monitoring_a_Remote_Job]]
.To Monitor a Job:

. Navigate to the Job page. This page is automatically displayed if you triggered the job with the `Execute now` setting. To monitor scheduled jobs, navigate to *Monitor* > *Jobs* and select the job run you wish to inspect.
. On the Job page, click the *Hosts* tab. This displays the list of hosts on which the job is running.
. In the *Host* column, click the name of the host that you want to inspect. This displays the *Detail of Commands* page where you can monitor the job execution in real time.
. Click *Back to Job* at any time to return to the *Job Details* page.

.For CLI Users

To monitor the progress of a job while it is running, complete the following steps:

. Find the ID of a job:
+
[options="nowrap", subs="+quotes,attributes"]
----
# hammer job-invocation list
----

. Monitor the job output:
+
[options="nowrap", subs="+quotes,attributes"]
----
# hammer job-invocation output \
--id _job_ID_ \
--host _host_name_
----

. Optional: to cancel a job, enter the following command:
+
[options="nowrap", subs="+quotes,attributes"]
----
# hammer job-invocation cancel \
--id _job_ID_
----

[[sect-Managing_Hosts-Creating_Advanced_Templates]]
==== Creating Advanced Templates

When creating a job template, you can include an existing template in the template editor field. This way you can combine templates, or create more specific templates from the general ones.

The following template combines default templates to install and start the *httpd* service on Red Hat Enterprise Linux systems:

[source, Ruby]
----
<%= render_template 'Package Action - SSH Default', :action => 'install', :package => 'httpd' %>
<%= render_template 'Service Action - SSH Default', :action => 'start', :service_name => 'httpd' %>
----

The above template specifies parameter values for the rendered template directly. It is also possible to use the *input()* method to allow users to define input for the rendered template on job execution. For example, you can use the following syntax:

[source, Ruby]
----
<%= render_template 'Package Action - SSH Default', :action => 'install', :package => input("package") %>
----

With the above template, you have to import the parameter definition from the rendered template. To do so, navigate to the *Jobs* tab, click *Add Foreign Input Set*, and select the rendered template from the *Target template* list. You can import all parameters or specify a comma separated list.

[[exam-Managing_Hosts-Rendering_a_restorecon_Template]]
.Rendering a restorecon Template
====
This example shows how to create a template derived from the *Run command - restorecon* template created in xref:exam-Managing_Hosts-Creating_a_restorecon_Template[]. This template does not require user input on job execution, it will restore the SELinux context in all files under the */home/* directory on target hosts.

Create a new template as described in xref:sect-Managing_Hosts-Setting_up_Job_Templates[], and specify the following string in the template editor:
[source, Ruby]
----
<%= render_template("Run Command - restorecon", :directory => "/home") %>
----

====

[[exam-Managing_Hosts-Including_Power_Actions_in_Templates]]
.Including Power Actions in Templates
====
This example shows how to set up a job template for performing power actions, such as reboot. This procedure prevents {Project} from interpreting the disconnect exception upon reboot as an error, and consequently, remote execution of the job works correctly.

Create a new template as described in xref:sect-Managing_Hosts-Setting_up_Job_Templates[], and specify the following string in the template editor:
[source, Ruby]
----
<%= render_template("Power Action - SSH Default", :action => "restart") %>
----

====

[[sect-Managing_Hosts-Delegating_Permissions]]
=== Delegating Permissions for Remote Execution

You can control which users can run which jobs within your infrastructure, including which hosts they can target. The remote execution feature provides two built-in roles:

* *Remote Execution Manager*: This role allows access to all remote execution features and functionality.

* *Remote Execution User*: This role only allows running jobs; it does not provide permission to modify job templates.



You can clone the Remote Execution User role and customize its filter for increased granularity. If you adjust the filter with the `view_job_templates` permission, the user can only see and trigger jobs based on matching job templates. You can use the `view_hosts` and `view_smart_proxies` permissions to limit which hosts or {SmartProxies} are visible to the role.

The `execute_template_invocation` permission is a special permission that is checked immediately before execution of a job begins. This permission defines which job template you can run on a particular host. This allows for even more granularity when specifying permissions. For more information on working with roles and permissions see link:{BaseURL}administering_red_hat_satellite/chap-red_hat_satellite-administering_red_hat_satellite-users_and_roles#sect-{Project_Link}-Administering_{Project_Link}-Users_and_Roles-Creating_and_Managing_Roles[Creating and Managing Roles] in the _Administering {ProjectName}_.

The following example shows filters for the `execute_template_invocation` permission:

[options="nowrap", subs="+quotes,verbatim,attributes"]
----
name = Reboot and host.name = staging.example.com
name = Reboot and host.name ~ *.staging.example.com
name = "Restart service" and host_group.name = webservers
----
The first line in the above example permits the user to apply the *Reboot* template to one selected host. The second line defines a pool of hosts with names ending with *.staging.example.com*. The third line binds the template with a host group.

[NOTE]
====
Permissions assigned to users can change over time. If a user has already scheduled some jobs to run in the future, and the permissions have changed, this can result in execution failure because the permissions are checked immediately before job execution.
====
